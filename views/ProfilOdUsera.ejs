<h1>
  <%= title %>
</h1>
<p>Welcomeee, <%= user.first_name %>!</p>



<button class="button">
  <span class="button_lg">
    <span class="button_sl"></span>
    <span class="button_text"><a href="/users/logout">Logout</a></span>
  </span>
</button>

<section class="section about-section gray-bg" id="about">
  <div class="container">

    <!-- GORNJI DIO PROFILA -->
    <div class="row align-items-center flex-row-reverse">

      <!-- DESNA STRANA – TEKST -->
      <div class="col-lg-6">
        <div class="about-text go-to">

          <h3 class="dark-color">About Me</h3>

          <h6 class="theme-color lead">
            <%= user.first_name %>
              <%= user.last_name %>
          </h6>

          <p>
            <%= user.bio || 'Korisnik još nije dodao opis profila.' %>
          </p>

          <div class="row about-list">

            <!-- LIJEVA KOLONA -->
            <div class="col-md-6">
              <div class="media">
                <label>Status</label>
                <p>
                  <%= user.status %>
                </p>
              </div>

              <div class="media">
                <label>Godine</label>
                <p>
                  <%= user.age || 'N/A' %>
                </p>
              </div>

              <div class="media">
                <label>Država</label>
                <p>
                  <%= user.country || 'N/A' %>
                </p>
              </div>

              <div class="media">
                <label>Grad</label>
                <p>
                  <%= user.city || 'N/A' %>
                </p>
              </div>
            </div>

            <!-- DESNA KOLONA -->
            <div class="col-md-6">
              <div class="media">
                <label>E-mail</label>
                <p>
                  <%= user.email %>
                </p>
              </div>

              <div class="media">
                <label>Telefon</label>
                <p>
                  <%= user.phone || 'N/A' %>
                </p>
              </div>

              <div class="media">
                <label>Spol</label>
                <p>
                  <%= user.gender || 'N/A' %>
                </p>
              </div>

              <div class="media">
                <label>Kreiran profil</label>
                <p>
                  <%= new Date(user.created_at).toLocaleDateString() %>
                </p>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- LIJEVA STRANA – AVATAR -->
      <div class="col-lg-6 text-center">
        <div class="about-avatar">
          <img src="https://bootdey.com/img/Content/avatar/avatar7.png" class="img-fluid rounded" alt="avatar">
        </div>
      </div>

    </div>

    <!-- DONJA STATISTIKA  -->
    <div class="counter mt-5">
      <div class="row">

        <div class="col-6 col-lg-3">
          <div class="count-data text-center">
            <h6 class="count h2">500</h6>
            <p class="m-0px font-w-600">Aktivni oglasi</p>
          </div>
        </div>

        <div class="col-6 col-lg-3">
          <div class="count-data text-center">
            <h6 class="count h2">150</h6>
            <p class="m-0px font-w-600">Završeni oglasi</p>
          </div>
        </div>

        <div class="col-6 col-lg-3">
          <div class="count-data text-center">
            <h6 class="count h2">850</h6>
            <p class="m-0px font-w-600">Ukupna zarada</p>
          </div>
        </div>

        <div class="col-6 col-lg-3">
          <div class="count-data text-center">
            <h6 class="count h2">7.2</h6>
            <p class="m-0px font-w-600">Prosjecna ocjena</p>
          </div>
        </div>

      </div>
    </div>

  </div>
</section>




<div class="container mt-5">

  <!-- GORNJA AKCIJA -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="m-0">Moje knjige</h3>

    <div>
      <a id="addBook" class="btn btn-success">
        + Dodaj knjigu
      </a>
      <a class="btn btn-success" href="/users/cart/">
        Narudžbe
      </a>
    </div>


  </div>


  <!-- GRID SA KARTICAMA -->
  <div class="row g-4" id="booksGrid">
    <% books.forEach(book=> { %>

      <div class="col-md-6 col-lg-4 mb-4" id="book_<%= book.id %>">

        <div class="card h-100 shadow-sm border-0 rounded-4">

          <!-- KARTICA BODY -->
          <div class="card-body d-flex flex-column">

            <!-- Naslov i autor -->
            <h5 class="card-title mb-2">
              <%= book.title %>
            </h5>
            <p class="mb-1 text-muted">
              <strong>Autor:</strong>
              <%= book.author %>
            </p>

            <!-- Cijena -->
            <p class="mb-3">
              <strong>Cijena:</strong>
              <%= book.price==0 ? 'Razmjena' : book.price + ' KM' %>
            </p>

            <!-- Status -->
            <p class="mb-3">
              <strong>Status:</strong>
              <% let badgeClass='bg-secondary' ; if (book.status==='AKTIVNA' ) badgeClass='bg-success' ; else if
                (book.status==='REZERVISANA' ) badgeClass='bg-warning' ; else if (book.status==='PRODANA' )
                badgeClass='bg-danger' ; else if (book.status==='RAZMIJENJENA' ) badgeClass='bg-info' ; else if
                (book.status==='ARHIVIRANA' ) badgeClass='bg-dark' ; %>
                <span class="badge <%= badgeClass %> px-3 py-2">
                  <%= book.status %>
                </span>
            </p>

            <!-- Godina izdanja i žanr -->
            <div class="d-flex justify-content-between text-muted mb-3">
              <small><strong>Godina izdanja:</strong>
                <%= book.publication_year || 'Nema podataka' %>
              </small>
              <small><strong>Žanr:</strong>
                <%= book.genre || 'Nema podataka' %>
              </small>
            </div>

            <!-- Opis -->
            <% if (book.description) { %>
              <div class="border-top pt-2">
                <p class="small text-muted">
                  <%= book.description.length> 120 ? book.description.substring(0, 120) + '...' : book.description %>
                </p>
              </div>
              <% } %>

          </div>

          <!-- KARTICA FOOTER -->
          <div class="card-footer bg-white border-0 d-flex justify-content-between align-items-center pt-3">

            <!-- Akcije (Update i Delete) -->
            <div class="btn-group">
              <a onclick="azuriraj(<%= book.id %>,books)" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-pencil-square"></i> Update
              </a>

              <button type="submit" onclick="brisi(<%= book.id %>)" class="btn btn-outline-danger btn-sm">
                <i class="bi bi-trash"></i> Delete
              </button>

            </div>

          </div>

        </div>
      </div>

      <% }) %>
  </div>



</div>






<div id="div_book_form" class="container mt-4 p-4 border rounded bg-light" style="display: none;">

  <!-- hidden id za edit -->
  <input type="hidden" id="book_id">

  <form id="book_form" class="form-horizontal">

    <!-- TITLE -->
    <div class="form-group mb-3">
      <label for="title">Naziv knjige </label>
      <input type="text" class="form-control" id="title" name="title" placeholder="Naziv knjige" required>
    </div>

    <!-- AUTHOR -->
    <div class="form-group mb-3">
      <label for="author">Autor </label>
      <input type="text" class="form-control" id="author" name="author" placeholder="Ime autora" required>
    </div>

    <!-- PUBLISHER -->
    <div class="form-group mb-3">
      <label for="publisher">Izdavač</label>
      <input type="text" class="form-control" id="publisher" name="publisher" placeholder="Naziv izdavača" required>
    </div>

    <!-- PUBLICATION YEAR -->
    <div class="form-group mb-3">
      <label for="publication_year">Godina izdanja</label>
      <input type="number" class="form-control" id="publication_year" name="publication_year" placeholder="npr. 2015"
        min="1400" max="2200" required>
    </div>

    <!-- GENRE -->
    <div class="form-group mb-3">
      <label for="genre">Žanr</label>
      <select class="form-control" id="genre" name="genre">
        <option value="">-- odaberi žanr --</option>

        <% allgenres.forEach(genre=> { %>
          <option value="<%= genre.id %>">
            <%= genre.name %>
          </option>
          <% }) %>
      </select>
    </div>

    <!-- LANGUAGE -->
    <div class="form-group mb-3">
      <label for="language">Jezik</label>
      <select class="form-control" id="language" name="language">
        <option value="">-- odaberi jezik --</option>

        <% alllanguages.forEach(lang=> { %>
          <option value="<%= lang.id %>">
            <%= lang.name %>
          </option>
          <% }) %>
      </select>

    </div>

    <!-- CONDITION -->
    <div class="form-group mb-3">
      <label for="condition">Stanje knjige</label>
      <select class="form-control" id="condition" name="condition">
        <option value="">-- odaberi stanje --</option>
        <option value="1">1 - Jako loše</option>
        <option value="2">2 - Loše</option>
        <option value="3">3 - Solidno</option>
        <option value="4">4 - Vrlo dobro</option>
        <option value="5">5 - Kao novo</option>
      </select>
    </div>

    <!-- PRICE -->
    <div class="form-group mb-3">
      <label for="price">Cijena (KM)</label>
      <input type="number" step="0.01" min="0" class="form-control" id="price" name="price"
        placeholder="0 ako je samo razmjena" required>
    </div>

    <!-- EXCHANGE -->
    <div class="form-group form-check mb-3">
      <input type="checkbox" class="form-check-input" id="exchange_available" name="exchange_available">
      <label class="form-check-label" for="exchange_available">
        Moguća razmjena
      </label>
    </div>


    <!-- LOCATION -->
    <!--    <div class="form-group mb-3">
      <label for="city_id">Lokacija preuzimanja</label>
      <select class="form-control" id="city_id" name="city_id">
        <option value="">-- odaberi grad --</option>
       
      </select>
    </div> 
    -->

    <!-- DESCRIPTION -->
    <div class="form-group mb-4">
      <label for="description">Opis</label>
      <textarea class="form-control" id="description" name="description" rows="4" placeholder="Opis knjige"></textarea>
    </div>

    <!-- STATUS -->
    <div class="form-group mb-4">
      <label for="status">Status *</label>
      <select class="form-control" id="status" name="status" required>
        <option value="AKTIVNA">Aktivna</option>
        <option value="REZERVISANA">Rezervisana</option>
        <option value="PRODANA">Prodana</option>
        <option value="RAZMIJENJENA">Razmijenjena</option>
        <option value="ARHIVIRANA">Arhivirana</option>
      </select>
    </div>

    <!-- BUTTONS -->
    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-success" id="book_submit_button">
        Sačuvaj knjigu
      </button>
      <button type="button" id="book_cancel_button" class="btn btn-outline-secondary">
        Otkaži
      </button>
    </div>

  </form>
</div>



<script>
  window.books = <%- JSON.stringify(books || []) %>;
</script>
