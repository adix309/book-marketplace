<div class="container mt-5">


  <h1>buyerr id <%= buyer_id %>
  </h1>
  


  <button class="button">
    <span class="button_text"><a href="/buyer/logout">Logout</a></span>
  </button>

  <h4>Online korisnici</h4>
<ul>
  <% online.forEach(id => { %>
    <li>
      <a href="/chat/<%= id %>">
        Chat sa korisnikom #<%= id %>
      </a>
    </li>
  <% }) %>
</ul>


  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold mb-0">Dobrodo≈°ao, <%= title %>üëã</h2>

    <form id="filterForm" class="d-flex align-items-center gap-2 mb-4">

      <!-- ≈ΩANR -->
      <select id="filterGenre" class="form-select form-select-sm" style="width:160px">
        <option value="">≈Ωanr</option>

        <% allgenres.forEach(g=> { %>
          <option value="<%= g.id %>">
            <%= g.name %>
          </option>
          <% }) %>
      </select>


      <!-- JEZIK -->
      <select id="filterLanguage" class="form-select form-select-sm" style="width:140px">
        <option value="">Jezik</option>

        <% alllanguages.forEach(l=> { %>
          <option value="<%= l.id %>">
            <%= l.name %>
          </option>
          <% }) %>
      </select>


      <!-- CIJENA -->
      <input id="priceFrom" type="number" class="form-control form-control-sm" placeholder="Cijena od"
        style="width:110px">
      <input id="priceTo" type="number" class="form-control form-control-sm" placeholder="Cijena do"
        style="width:110px">

      <!-- TEXT SEARCH -->
      <input id="searchText" type="text" class="form-control form-control-sm" placeholder="Naziv / autor">

      <!-- BUTTON -->
      <button type="submit" class="btn btn-sm btn-primary">
        Filter
      </button>
      <button><a href="/buyer/cart">korpa</a></button>

    </form>


  </div>




  <!-- ================= NAJPOPULARNIJE ================= -->
  <section class="mb-5">
    <h4 class="mb-3">üî• Najpopularnije knjige</h4>

    <div class="row g-4">
      <% AllBooks.forEach(book=> { %>
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm book-card" id="book_<%= book.id %>" class="card book-card"
            onclick='openBookModal(<%- JSON.stringify(book) %>)'>

            <div class="card-body">
              <h5 class="card-title">
                <%= book.title %>
              </h5>
              <p class="text-muted mb-1">
                <%= book.author %>
              </p>

              <p class="fw-bold text-success">
                <%= book.price==0 ? 'Razmjena' : book.price + ' KM' %>
              </p>


              <p>
                <span class="badge bg-info">
                  <%= book.genre_name || '≈Ωanr' %>
                </span>
                <span class="badge bg-success">
                  <%= book.status %>
                </span>
                <strong>Jezik:</strong>
                <%= book.language_name || '‚Äî' %>

              </p>
            </div>

          </div>
        </div>
        <% }) %>
    </div>
  </section>

  <!-- ================= RANDOM ================= -->
  <section class="mb-5">
    <h4 class="mb-3">üé≤ Sluƒçajno odabrane knjige</h4>

    <div class="row g-4">
      <% randomBooks.forEach(book=> { %>
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm book-card" id="book_<%= book.id %>" class="card book-card"
            onclick='openBookModal(<%- JSON.stringify(book) %>)'>

            <div class="card-body">
              <h5 class="card-title">
                <%= book.title %>
              </h5>
              <p class="text-muted mb-1">
                <%= book.author %>
              </p>

              <p>
                <span class="badge bg-info">
                  <%= book.genre || '≈Ωanr' %>
                </span>
                <span class="badge bg-success">
                  <%= book.status %>
                </span>
                <strong>Jezik:</strong>
                <%= book.language || '‚Äî' %>

              </p>
            </div>

          </div>
        </div>
        <% }) %>
    </div>
  </section>

  <!-- ================= PREPORUƒåENE ================= -->
  <section class="mb-5">
    <h4 class="mb-3">‚≠ê Preporuƒçene za vas</h4>

    <div class="row g-4">
      <% recommendedBooks.forEach(book=> { %>
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm book-card" id="book_<%= book.id %>" class="card book-card"
            onclick='openBookModal(<%- JSON.stringify(book) %>)'>


            <div class="card-body">
              <h5 class="card-title">
                <%= book.title %>
              </h5>
              <p class="text-muted mb-1">
                <%= book.author %>
              </p>

              <p>
                <span class="badge bg-info">
                  <%= book.genre || '≈Ωanr' %>
                </span>
                <span class="badge bg-success">
                  <%= book.status %>
                </span>
                <strong>Jezik:</strong>
                <%= book.language || '‚Äî' %>

              </p>
            </div>

          </div>
        </div>
        <% }) %>
    </div>
  </section>

</div>

<!-- ================= MODAL ================= -->
<div class="modal fade" id="bookModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content rounded-4 shadow">

      <!-- HEADER -->
      <div class="modal-header">
        <div>
          <h4 class="modal-title fw-bold" id="modalTitle"></h4>
          <p class="text-muted mb-0" id="modalAuthor"></p>
        </div>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-6">
            <p><strong>Cijena:</strong>
              <span id="modalPrice" class="fw-bold text-success"></span>
            </p>
            <p><strong>Status:</strong>
              <span id="modalStatus"></span>
            </p>
            <p><strong>≈Ωanr:</strong>
              <span id="modalGenre"></span>
            </p>
            <p><strong>Jezik:</strong>
              <span id="modalLanguage"></span>
            </p>
          </div>

          <div class="col-md-6">
            <p><strong>Godina izdanja:</strong>
              <span id="modalYear"></span>
            </p>

            <p><strong>Stanje:</strong>
              <span id="modalCondition"></span> / 5
            </p>

            <p><strong>Razmjena:</strong>
              <span id="modalExchange"></span>
            </p>
          </div>

        </div>

        <hr>

        <h6 class="fw-bold">Opis knjige</h6>
        <p id="modalDescription" class="text-muted"></p>

      </div>

      <!-- FOOTER -->
      <div class="modal-footer d-flex justify-content-between">
        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
          Zatvori
        </button>

        <button id="buyButton" class="btn btn-success">
          Kupi knjigu</button>
      </div>

    </div>
  </div>
</div>


<!--Bootstrap kood za obavijest da je kupljeno -->
<div id="buyAlert" class="toast position-fixed bottom-0 end-0 m-3" role="alert" data-bs-delay="1500">
  <div class="toast-body bg-success text-white">
    Kupljena knjiga
  </div>
</div>


<!-- ================= JS ================= -->